#!/bin/bash

# Based on code generated by Claude 3.7 Sonnet

# This script compiles and runs leetcode solutions.
# Usage: ./run array/two_sum.cpp

# XTerm escape sequences for colored text,
# used by msg_* to print colored text to stderr.
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

msg() {
    printf "$1\n" > /dev/stderr
}

msg_good() {
    msg "${GREEN}$1${NC}"
}

msg_bad() {
    msg "${RED}$1${NC}"
}

# Check if a path argument was provided
if [ $# -ne 1 ]; then
    msg "Usage: $0 <path/to/solution>"
    exit 1
fi

# Get the path argument
SOLUTION_SRC="$1"
SOLUTION_BIN="bin/${SOLUTION_SRC%.*}.out"

# Check if the .cpp file exists
if [ ! -f "${SOLUTION_SRC}" ]; then
    msg_bad "Error: ${SOLUTION_SRC} does not exist."
    exit 1
fi

# Create the binary's directory.
SOLUTION_BIN_PATH="$(dirname ${SOLUTION_BIN})"
if [ ! -d "${SOLUTION_BIN_PATH}" ]; then
    msg_good "Creating the binary directory..."
    mkdir -p "${SOLUTION_BIN_PATH}"
    if [ $? -ne 0 ]; then
        msg_bad "Failed to create the directory."
    fi
fi

# Compile the .cpp file using the Makefile
msg_good "Compiling ${SOLUTION_SRC}..."
make FILE="${SOLUTION_SRC}" TARGET="${SOLUTION_BIN}"

# Check if compilation was successful
if [ $? -ne 0 ]; then
    msg_bad "Compilation failed."
    exit 1
fi

# Run the executable
msg_good "Running solution..."
"./${SOLUTION_BIN}"

if [ $? -eq 0 ]; then
    msg_good "Done."
    exit 0
fi

msg_bad "The solution binary exited with an error code = $?"
exit $?
